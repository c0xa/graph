import {ChangeDetectorRef, Component, ElementRef, OnChanges, OnInit, SimpleChanges, ViewChild} from '@angular/core';
import * as d3 from 'd3';
import {HttpService} from "./logic/models/HttpService";
import {Link, NodeGraph} from "./d3";
import {Observable} from "rxjs";
import {scaleRadial} from "d3";
import {Constant} from "./data";


@Component({
    selector: 'app-root',
    templateUrl: './app.component.html',
    styleUrls: ['./app.component.less']
})

export class AppComponent implements OnInit {

    @ViewChild("slider") slider: ElementRef | undefined;

    time: number = 1;
    nodes: NodeGraph[] = [];
    links: Link[] = [];

    state: number = 2;

    dataJson: Observable<any> = new Observable;
    mapNodes: Map<string, NodeGraph> = new Map<string, NodeGraph>();
    allLinks: Link[] = [];

    defaultData = "{\"nodes\": [{\"id\": \"0\"}, {\"id\": \"1\"}, {\"id\": \"2\"}, {\"id\": \"3\"}, {\"id\": \"4\"}, {\"id\": \"5\"}, {\"id\": \"6\"}, {\"id\": \"7\"}, {\"id\": \"8\"}, {\"id\": \"9\"}, {\"id\": \"10\"}, {\"id\": \"11\"}, {\"id\": \"12\"}, {\"id\": \"13\"}, {\"id\": \"14\"}, {\"id\": \"15\"}, {\"id\": \"16\"}, {\"id\": \"17\"}, {\"id\": \"18\"}, {\"id\": \"19\"}, {\"id\": \"20\"}, {\"id\": \"21\"}, {\"id\": \"22\"}, {\"id\": \"23\"}, {\"id\": \"24\"}, {\"id\": \"25\"}, {\"id\": \"26\"}, {\"id\": \"27\"}, {\"id\": \"28\"}, {\"id\": \"29\"}, {\"id\": \"30\"}, {\"id\": \"31\"}, {\"id\": \"32\"}, {\"id\": \"33\"}, {\"id\": \"34\"}, {\"id\": \"35\"}, {\"id\": \"36\"}, {\"id\": \"37\"}, {\"id\": \"38\"}, {\"id\": \"39\"}, {\"id\": \"40\"}, {\"id\": \"41\"}, {\"id\": \"42\"}, {\"id\": \"43\"}, {\"id\": \"44\"}, {\"id\": \"45\"}, {\"id\": \"46\"}, {\"id\": \"47\"}, {\"id\": \"48\"}, {\"id\": \"49\"}, {\"id\": \"50\"}, {\"id\": \"51\"}, {\"id\": \"52\"}, {\"id\": \"53\"}, {\"id\": \"54\"}, {\"id\": \"55\"}, {\"id\": \"56\"}, {\"id\": \"57\"}, {\"id\": \"58\"}, {\"id\": \"59\"}, {\"id\": \"60\"}, {\"id\": \"61\"}, {\"id\": \"62\"}, {\"id\": \"63\"}, {\"id\": \"64\"}, {\"id\": \"65\"}, {\"id\": \"66\"}, {\"id\": \"67\"}, {\"id\": \"68\"}, {\"id\": \"69\"}, {\"id\": \"70\"}, {\"id\": \"71\"}, {\"id\": \"72\"}, {\"id\": \"73\"}, {\"id\": \"74\"}, {\"id\": \"75\"}, {\"id\": \"76\"}, {\"id\": \"77\"}, {\"id\": \"78\"}, {\"id\": \"79\"}, {\"id\": \"80\"}, {\"id\": \"81\"}, {\"id\": \"82\"}, {\"id\": \"83\"}, {\"id\": \"84\"}, {\"id\": \"85\"}, {\"id\": \"86\"}, {\"id\": \"87\"}, {\"id\": \"88\"}, {\"id\": \"89\"}, {\"id\": \"90\"}, {\"id\": \"91\"}, {\"id\": \"92\"}, {\"id\": \"93\"}, {\"id\": \"94\"}, {\"id\": \"95\"}, {\"id\": \"96\"}, {\"id\": \"97\"}, {\"id\": \"98\"}, {\"id\": \"99\"}, {\"id\": \"100\"}, {\"id\": \"101\"}, {\"id\": \"102\"}, {\"id\": \"103\"}, {\"id\": \"104\"}, {\"id\": \"105\"}, {\"id\": \"106\"}, {\"id\": \"107\"}, {\"id\": \"108\"}, {\"id\": \"109\"}, {\"id\": \"110\"}, {\"id\": \"111\"}, {\"id\": \"112\"}, {\"id\": \"113\"}, {\"id\": \"114\"}, {\"id\": \"115\"}, {\"id\": \"116\"}, {\"id\": \"117\"}, {\"id\": \"118\"}, {\"id\": \"119\"}, {\"id\": \"120\"}, {\"id\": \"121\"}, {\"id\": \"122\"}, {\"id\": \"123\"}, {\"id\": \"124\"}, {\"id\": \"125\"}, {\"id\": \"126\"}, {\"id\": \"127\"}, {\"id\": \"128\"}, {\"id\": \"129\"}, {\"id\": \"130\"}, {\"id\": \"131\"}, {\"id\": \"132\"}, {\"id\": \"133\"}, {\"id\": \"134\"}, {\"id\": \"135\"}, {\"id\": \"136\"}, {\"id\": \"137\"}, {\"id\": \"138\"}, {\"id\": \"139\"}, {\"id\": \"140\"}, {\"id\": \"141\"}, {\"id\": \"142\"}, {\"id\": \"143\"}, {\"id\": \"144\"}, {\"id\": \"145\"}, {\"id\": \"146\"}, {\"id\": \"147\"}, {\"id\": \"148\"}, {\"id\": \"149\"}, {\"id\": \"150\"}, {\"id\": \"151\"}, {\"id\": \"152\"}, {\"id\": \"153\"}, {\"id\": \"154\"}, {\"id\": \"155\"}, {\"id\": \"156\"}, {\"id\": \"157\"}, {\"id\": \"158\"}, {\"id\": \"159\"}, {\"id\": \"160\"}, {\"id\": \"161\"}, {\"id\": \"162\"}, {\"id\": \"163\"}, {\"id\": \"164\"}, {\"id\": \"165\"}, {\"id\": \"166\"}, {\"id\": \"167\"}, {\"id\": \"168\"}, {\"id\": \"169\"}, {\"id\": \"170\"}, {\"id\": \"171\"}, {\"id\": \"172\"}, {\"id\": \"173\"}, {\"id\": \"174\"}, {\"id\": \"175\"}, {\"id\": \"176\"}, {\"id\": \"177\"}, {\"id\": \"178\"}, {\"id\": \"179\"}, {\"id\": \"180\"}, {\"id\": \"181\"}, {\"id\": \"182\"}, {\"id\": \"183\"}, {\"id\": \"184\"}, {\"id\": \"185\"}, {\"id\": \"186\"}, {\"id\": \"187\"}, {\"id\": \"188\"}, {\"id\": \"189\"}, {\"id\": \"190\"}, {\"id\": \"191\"}, {\"id\": \"192\"}, {\"id\": \"193\"}, {\"id\": \"194\"}, {\"id\": \"195\"}, {\"id\": \"196\"}, {\"id\": \"197\"}, {\"id\": \"198\"}, {\"id\": \"199\"}], \"links\": [{\"source\": \"0\", \"target\": \"186\", \"value\": 1919, \"time\": 1}, {\"source\": \"2\", \"target\": \"140\", \"value\": 1705, \"time\": 1}, {\"source\": \"2\", \"target\": \"50\", \"value\": 1911, \"time\": 1}, {\"source\": \"3\", \"target\": \"181\", \"value\": 1847, \"time\": 1}, {\"source\": \"3\", \"target\": \"14\", \"value\": 1400, \"time\": 1}, {\"source\": \"4\", \"target\": \"47\", \"value\": 1786, \"time\": 1}, {\"source\": \"4\", \"target\": \"59\", \"value\": 1765, \"time\": 1}, {\"source\": \"5\", \"target\": \"71\", \"value\": 1841, \"time\": 1}, {\"source\": \"5\", \"target\": \"13\", \"value\": 1225, \"time\": 1}, {\"source\": \"5\", \"target\": \"137\", \"value\": 1104, \"time\": 1}, {\"source\": \"7\", \"target\": \"177\", \"value\": 1235, \"time\": 1}, {\"source\": \"7\", \"target\": \"5\", \"value\": 1388, \"time\": 1}, {\"source\": \"7\", \"target\": \"32\", \"value\": 1042, \"time\": 1}, {\"source\": \"7\", \"target\": \"161\", \"value\": 1974, \"time\": 1}, {\"source\": \"9\", \"target\": \"184\", \"value\": 1081, \"time\": 1}, {\"source\": \"9\", \"target\": \"148\", \"value\": 1037, \"time\": 1}, {\"source\": \"10\", \"target\": \"108\", \"value\": 1401, \"time\": 1}, {\"source\": \"10\", \"target\": \"160\", \"value\": 1626, \"time\": 1}, {\"source\": \"11\", \"target\": \"157\", \"value\": 1608, \"time\": 1}, {\"source\": \"12\", \"target\": \"154\", \"value\": 1109, \"time\": 1}, {\"source\": \"12\", \"target\": \"9\", \"value\": 1646, \"time\": 1}, {\"source\": \"12\", \"target\": \"26\", \"value\": 1540, \"time\": 1}, {\"source\": \"13\", \"target\": \"64\", \"value\": 1071, \"time\": 1}, {\"source\": \"13\", \"target\": \"140\", \"value\": 1501, \"time\": 1}, {\"source\": \"13\", \"target\": \"109\", \"value\": 1308, \"time\": 1}, {\"source\": \"13\", \"target\": \"98\", \"value\": 1964, \"time\": 1}, {\"source\": \"14\", \"target\": \"185\", \"value\": 1380, \"time\": 1}, {\"source\": \"14\", \"target\": \"179\", \"value\": 1204, \"time\": 1}, {\"source\": \"15\", \"target\": \"141\", \"value\": 1274, \"time\": 1}, {\"source\": \"15\", \"target\": \"19\", \"value\": 1969, \"time\": 1}, {\"source\": \"16\", \"target\": \"149\", \"value\": 1817, \"time\": 1}, {\"source\": \"16\", \"target\": \"12\", \"value\": 1925, \"time\": 1}, {\"source\": \"16\", \"target\": \"160\", \"value\": 1294, \"time\": 1}, {\"source\": \"17\", \"target\": \"117\", \"value\": 1677, \"time\": 1}, {\"source\": \"17\", \"target\": \"11\", \"value\": 1918, \"time\": 1}, {\"source\": \"18\", \"target\": \"96\", \"value\": 1944, \"time\": 1}, {\"source\": \"18\", \"target\": \"121\", \"value\": 1575, \"time\": 1}, {\"source\": \"18\", \"target\": \"139\", \"value\": 1395, \"time\": 1}, {\"source\": \"19\", \"target\": \"72\", \"value\": 1984, \"time\": 1}, {\"source\": \"20\", \"target\": \"47\", \"value\": 1604, \"time\": 1}, {\"source\": \"21\", \"target\": \"149\", \"value\": 1455, \"time\": 1}, {\"source\": \"22\", \"target\": \"95\", \"value\": 1619, \"time\": 1}, {\"source\": \"23\", \"target\": \"173\", \"value\": 1032, \"time\": 1}, {\"source\": \"23\", \"target\": \"156\", \"value\": 1297, \"time\": 1}, {\"source\": \"23\", \"target\": \"164\", \"value\": 1045, \"time\": 1}, {\"source\": \"23\", \"target\": \"52\", \"value\": 1909, \"time\": 1}, {\"source\": \"24\", \"target\": \"127\", \"value\": 1106, \"time\": 1}, {\"source\": \"24\", \"target\": \"187\", \"value\": 1114, \"time\": 1}, {\"source\": \"25\", \"target\": \"2\", \"value\": 1017, \"time\": 1}, {\"source\": \"25\", \"target\": \"46\", \"value\": 1390, \"time\": 1}, {\"source\": \"26\", \"target\": \"154\", \"value\": 1437, \"time\": 1}, {\"source\": \"27\", \"target\": \"108\", \"value\": 1227, \"time\": 1}, {\"source\": \"28\", \"target\": \"184\", \"value\": 1966, \"time\": 1}, {\"source\": \"28\", \"target\": \"114\", \"value\": 1023, \"time\": 1}, {\"source\": \"28\", \"target\": \"40\", \"value\": 1599, \"time\": 1}, {\"source\": \"29\", \"target\": \"187\", \"value\": 1378, \"time\": 1}, {\"source\": \"29\", \"target\": \"116\", \"value\": 1634, \"time\": 1}, {\"source\": \"29\", \"target\": \"37\", \"value\": 1410, \"time\": 1}, {\"source\": \"30\", \"target\": \"57\", \"value\": 1539, \"time\": 1}, {\"source\": \"30\", \"target\": \"111\", \"value\": 1435, \"time\": 1}, {\"source\": \"31\", \"target\": \"172\", \"value\": 1405, \"time\": 1}, {\"source\": \"31\", \"target\": \"85\", \"value\": 1560, \"time\": 1}, {\"source\": \"31\", \"target\": \"138\", \"value\": 1567, \"time\": 1}, {\"source\": \"32\", \"target\": \"176\", \"value\": 1256, \"time\": 1}, {\"source\": \"33\", \"target\": \"14\", \"value\": 1286, \"time\": 1}, {\"source\": \"34\", \"target\": \"1\", \"value\": 1310, \"time\": 1}, {\"source\": \"34\", \"target\": \"137\", \"value\": 1094, \"time\": 1}, {\"source\": \"35\", \"target\": \"155\", \"value\": 1365, \"time\": 1}, {\"source\": \"35\", \"target\": \"192\", \"value\": 1056, \"time\": 1}, {\"source\": \"35\", \"target\": \"88\", \"value\": 1137, \"time\": 1}, {\"source\": \"36\", \"target\": \"159\", \"value\": 1462, \"time\": 1}, {\"source\": \"36\", \"target\": \"20\", \"value\": 1005, \"time\": 1}, {\"source\": \"36\", \"target\": \"116\", \"value\": 1641, \"time\": 1}, {\"source\": \"37\", \"target\": \"3\", \"value\": 1003, \"time\": 1}, {\"source\": \"37\", \"target\": \"56\", \"value\": 1653, \"time\": 1}, {\"source\": \"37\", \"target\": \"151\", \"value\": 1027, \"time\": 1}, {\"source\": \"38\", \"target\": \"72\", \"value\": 1507, \"time\": 1}, {\"source\": \"39\", \"target\": \"95\", \"value\": 1774, \"time\": 1}, {\"source\": \"39\", \"target\": \"58\", \"value\": 1455, \"time\": 1}, {\"source\": \"39\", \"target\": \"48\", \"value\": 1398, \"time\": 1}, {\"source\": \"40\", \"target\": \"30\", \"value\": 1858, \"time\": 1}, {\"source\": \"41\", \"target\": \"23\", \"value\": 1266, \"time\": 1}, {\"source\": \"41\", \"target\": \"82\", \"value\": 1186, \"time\": 1}, {\"source\": \"42\", \"target\": \"139\", \"value\": 1884, \"time\": 1}, {\"source\": \"42\", \"target\": \"52\", \"value\": 1531, \"time\": 1}, {\"source\": \"43\", \"target\": \"70\", \"value\": 1589, \"time\": 1}, {\"source\": \"44\", \"target\": \"38\", \"value\": 1958, \"time\": 1}, {\"source\": \"44\", \"target\": \"170\", \"value\": 1270, \"time\": 1}, {\"source\": \"45\", \"target\": \"106\", \"value\": 1077, \"time\": 1}, {\"source\": \"45\", \"target\": \"99\", \"value\": 1539, \"time\": 1}, {\"source\": \"46\", \"target\": \"150\", \"value\": 1309, \"time\": 1}, {\"source\": \"46\", \"target\": \"79\", \"value\": 1165, \"time\": 1}, {\"source\": \"46\", \"target\": \"85\", \"value\": 1856, \"time\": 1}, {\"source\": \"47\", \"target\": \"136\", \"value\": 1548, \"time\": 1}, {\"source\": \"49\", \"target\": \"14\", \"value\": 1199, \"time\": 1}, {\"source\": \"49\", \"target\": \"42\", \"value\": 1894, \"time\": 1}, {\"source\": \"50\", \"target\": \"70\", \"value\": 1052, \"time\": 1}, {\"source\": \"50\", \"target\": \"26\", \"value\": 1776, \"time\": 1}, {\"source\": \"52\", \"target\": \"118\", \"value\": 1010, \"time\": 1}, {\"source\": \"53\", \"target\": \"56\", \"value\": 1734, \"time\": 1}, {\"source\": \"53\", \"target\": \"88\", \"value\": 1815, \"time\": 1}, {\"source\": \"53\", \"target\": \"57\", \"value\": 1741, \"time\": 1}, {\"source\": \"54\", \"target\": \"150\", \"value\": 1058, \"time\": 1}, {\"source\": \"55\", \"target\": \"31\", \"value\": 1880, \"time\": 1}, {\"source\": \"55\", \"target\": \"149\", \"value\": 1928, \"time\": 1}, {\"source\": \"56\", \"target\": \"95\", \"value\": 1432, \"time\": 1}, {\"source\": \"57\", \"target\": \"55\", \"value\": 1585, \"time\": 1}, {\"source\": \"57\", \"target\": \"92\", \"value\": 1962, \"time\": 1}, {\"source\": \"57\", \"target\": \"138\", \"value\": 1369, \"time\": 1}, {\"source\": \"59\", \"target\": \"120\", \"value\": 1571, \"time\": 1}, {\"source\": \"59\", \"target\": \"143\", \"value\": 1871, \"time\": 1}, {\"source\": \"59\", \"target\": \"8\", \"value\": 1860, \"time\": 1}, {\"source\": \"60\", \"target\": \"140\", \"value\": 1954, \"time\": 1}, {\"source\": \"61\", \"target\": \"198\", \"value\": 1140, \"time\": 1}, {\"source\": \"61\", \"target\": \"48\", \"value\": 1577, \"time\": 1}, {\"source\": \"62\", \"target\": \"177\", \"value\": 1138, \"time\": 1}, {\"source\": \"62\", \"target\": \"56\", \"value\": 1374, \"time\": 1}, {\"source\": \"62\", \"target\": \"11\", \"value\": 1682, \"time\": 1}, {\"source\": \"62\", \"target\": \"150\", \"value\": 1725, \"time\": 1}, {\"source\": \"64\", \"target\": \"143\", \"value\": 1697, \"time\": 1}, {\"source\": \"64\", \"target\": \"176\", \"value\": 1351, \"time\": 1}, {\"source\": \"65\", \"target\": \"152\", \"value\": 1823, \"time\": 1}, {\"source\": \"65\", \"target\": \"40\", \"value\": 1287, \"time\": 1}, {\"source\": \"65\", \"target\": \"190\", \"value\": 1516, \"time\": 1}, {\"source\": \"66\", \"target\": \"138\", \"value\": 1827, \"time\": 1}, {\"source\": \"68\", \"target\": \"168\", \"value\": 1296, \"time\": 1}, {\"source\": \"68\", \"target\": \"99\", \"value\": 1148, \"time\": 1}, {\"source\": \"68\", \"target\": \"16\", \"value\": 1093, \"time\": 1}, {\"source\": \"68\", \"target\": \"142\", \"value\": 1804, \"time\": 1}, {\"source\": \"70\", \"target\": \"32\", \"value\": 1758, \"time\": 1}, {\"source\": \"70\", \"target\": \"63\", \"value\": 1975, \"time\": 1}, {\"source\": \"71\", \"target\": \"120\", \"value\": 1731, \"time\": 1}, {\"source\": \"71\", \"target\": \"168\", \"value\": 1763, \"time\": 1}, {\"source\": \"72\", \"target\": \"43\", \"value\": 1720, \"time\": 1}, {\"source\": \"72\", \"target\": \"175\", \"value\": 1582, \"time\": 1}, {\"source\": \"73\", \"target\": \"52\", \"value\": 1116, \"time\": 1}, {\"source\": \"73\", \"target\": \"160\", \"value\": 1208, \"time\": 1}, {\"source\": \"74\", \"target\": \"190\", \"value\": 1306, \"time\": 1}, {\"source\": \"75\", \"target\": \"19\", \"value\": 1955, \"time\": 1}, {\"source\": \"75\", \"target\": \"94\", \"value\": 1098, \"time\": 1}, {\"source\": \"75\", \"target\": \"194\", \"value\": 1003, \"time\": 1}, {\"source\": \"76\", \"target\": \"108\", \"value\": 1995, \"time\": 1}, {\"source\": \"76\", \"target\": \"115\", \"value\": 1901, \"time\": 1}, {\"source\": \"77\", \"target\": \"32\", \"value\": 1505, \"time\": 1}, {\"source\": \"78\", \"target\": \"106\", \"value\": 1668, \"time\": 1}, {\"source\": \"79\", \"target\": \"22\", \"value\": 1449, \"time\": 1}, {\"source\": \"80\", \"target\": \"27\", \"value\": 1210, \"time\": 1}, {\"source\": \"80\", \"target\": \"176\", \"value\": 1716, \"time\": 1}, {\"source\": \"80\", \"target\": \"61\", \"value\": 1970, \"time\": 1}, {\"source\": \"81\", \"target\": \"165\", \"value\": 1060, \"time\": 1}, {\"source\": \"82\", \"target\": \"112\", \"value\": 1520, \"time\": 1}, {\"source\": \"82\", \"target\": \"113\", \"value\": 1369, \"time\": 1}, {\"source\": \"83\", \"target\": \"42\", \"value\": 1050, \"time\": 1}, {\"source\": \"83\", \"target\": \"53\", \"value\": 1313, \"time\": 1}, {\"source\": \"84\", \"target\": \"52\", \"value\": 1382, \"time\": 1}, {\"source\": \"86\", \"target\": \"115\", \"value\": 1992, \"time\": 1}, {\"source\": \"86\", \"target\": \"92\", \"value\": 1454, \"time\": 1}, {\"source\": \"86\", \"target\": \"183\", \"value\": 1541, \"time\": 1}, {\"source\": \"86\", \"target\": \"119\", \"value\": 1052, \"time\": 1}, {\"source\": \"86\", \"target\": \"166\", \"value\": 1631, \"time\": 1}, {\"source\": \"87\", \"target\": \"60\", \"value\": 1283, \"time\": 1}, {\"source\": \"87\", \"target\": \"131\", \"value\": 1492, \"time\": 1}, {\"source\": \"87\", \"target\": \"28\", \"value\": 1158, \"time\": 1}, {\"source\": \"87\", \"target\": \"69\", \"value\": 1610, \"time\": 1}, {\"source\": \"89\", \"target\": \"88\", \"value\": 1596, \"time\": 1}, {\"source\": \"89\", \"target\": \"193\", \"value\": 1139, \"time\": 1}, {\"source\": \"90\", \"target\": \"53\", \"value\": 1096, \"time\": 1}, {\"source\": \"91\", \"target\": \"47\", \"value\": 1233, \"time\": 1}, {\"source\": \"91\", \"target\": \"45\", \"value\": 1558, \"time\": 1}, {\"source\": \"91\", \"target\": \"84\", \"value\": 1460, \"time\": 1}, {\"source\": \"91\", \"target\": \"121\", \"value\": 1930, \"time\": 1}, {\"source\": \"92\", \"target\": \"129\", \"value\": 1067, \"time\": 1}, {\"source\": \"92\", \"target\": \"10\", \"value\": 1727, \"time\": 1}, {\"source\": \"93\", \"target\": \"163\", \"value\": 1626, \"time\": 1}, {\"source\": \"93\", \"target\": \"25\", \"value\": 1694, \"time\": 1}, {\"source\": \"94\", \"target\": \"50\", \"value\": 1356, \"time\": 1}, {\"source\": \"95\", \"target\": \"193\", \"value\": 1921, \"time\": 1}, {\"source\": \"96\", \"target\": \"142\", \"value\": 1781, \"time\": 1}, {\"source\": \"96\", \"target\": \"45\", \"value\": 1848, \"time\": 1}, {\"source\": \"97\", \"target\": \"21\", \"value\": 1378, \"time\": 1}, {\"source\": \"98\", \"target\": \"170\", \"value\": 1085, \"time\": 1}, {\"source\": \"98\", \"target\": \"16\", \"value\": 1432, \"time\": 1}, {\"source\": \"99\", \"target\": \"110\", \"value\": 1123, \"time\": 1}, {\"source\": \"99\", \"target\": \"5\", \"value\": 1743, \"time\": 1}, {\"source\": \"100\", \"target\": \"93\", \"value\": 1238, \"time\": 1}, {\"source\": \"101\", \"target\": \"197\", \"value\": 1605, \"time\": 1}, {\"source\": \"102\", \"target\": \"80\", \"value\": 1680, \"time\": 1}, {\"source\": \"102\", \"target\": \"67\", \"value\": 1450, \"time\": 1}, {\"source\": \"102\", \"target\": \"120\", \"value\": 1337, \"time\": 1}, {\"source\": \"103\", \"target\": \"43\", \"value\": 1589, \"time\": 1}, {\"source\": \"104\", \"target\": \"75\", \"value\": 1662, \"time\": 1}, {\"source\": \"104\", \"target\": \"115\", \"value\": 1666, \"time\": 1}, {\"source\": \"104\", \"target\": \"20\", \"value\": 1254, \"time\": 1}, {\"source\": \"105\", \"target\": \"133\", \"value\": 1323, \"time\": 1}, {\"source\": \"106\", \"target\": \"30\", \"value\": 1814, \"time\": 1}, {\"source\": \"106\", \"target\": \"163\", \"value\": 1511, \"time\": 1}, {\"source\": \"107\", \"target\": \"62\", \"value\": 1837, \"time\": 1}, {\"source\": \"107\", \"target\": \"3\", \"value\": 1290, \"time\": 1}, {\"source\": \"108\", \"target\": \"63\", \"value\": 1909, \"time\": 1}, {\"source\": \"108\", \"target\": \"119\", \"value\": 1528, \"time\": 1}, {\"source\": \"109\", \"target\": \"171\", \"value\": 1352, \"time\": 1}, {\"source\": \"111\", \"target\": \"35\", \"value\": 1977, \"time\": 1}, {\"source\": \"111\", \"target\": \"6\", \"value\": 1157, \"time\": 1}, {\"source\": \"112\", \"target\": \"139\", \"value\": 1509, \"time\": 1}, {\"source\": \"113\", \"target\": \"190\", \"value\": 1129, \"time\": 1}, {\"source\": \"113\", \"target\": \"171\", \"value\": 1453, \"time\": 1}, {\"source\": \"115\", \"target\": \"139\", \"value\": 1641, \"time\": 1}, {\"source\": \"115\", \"target\": \"156\", \"value\": 1423, \"time\": 1}, {\"source\": \"116\", \"target\": \"171\", \"value\": 1619, \"time\": 1}, {\"source\": \"116\", \"target\": \"129\", \"value\": 1026, \"time\": 1}, {\"source\": \"117\", \"target\": \"161\", \"value\": 1070, \"time\": 1}, {\"source\": \"117\", \"target\": \"187\", \"value\": 1672, \"time\": 1}, {\"source\": \"117\", \"target\": \"94\", \"value\": 1692, \"time\": 1}, {\"source\": \"118\", \"target\": \"17\", \"value\": 1673, \"time\": 1}, {\"source\": \"119\", \"target\": \"18\", \"value\": 1546, \"time\": 1}, {\"source\": \"119\", \"target\": \"155\", \"value\": 1851, \"time\": 1}, {\"source\": \"120\", \"target\": \"75\", \"value\": 1368, \"time\": 1}, {\"source\": \"121\", \"target\": \"109\", \"value\": 1414, \"time\": 1}, {\"source\": \"121\", \"target\": \"195\", \"value\": 1372, \"time\": 1}, {\"source\": \"123\", \"target\": \"133\", \"value\": 1990, \"time\": 1}, {\"source\": \"123\", \"target\": \"136\", \"value\": 1459, \"time\": 1}, {\"source\": \"123\", \"target\": \"113\", \"value\": 1646, \"time\": 1}, {\"source\": \"123\", \"target\": \"183\", \"value\": 1895, \"time\": 1}, {\"source\": \"124\", \"target\": \"184\", \"value\": 1968, \"time\": 1}, {\"source\": \"125\", \"target\": \"91\", \"value\": 1798, \"time\": 1}, {\"source\": \"126\", \"target\": \"151\", \"value\": 1264, \"time\": 1}, {\"source\": \"126\", \"target\": \"110\", \"value\": 1812, \"time\": 1}, {\"source\": \"127\", \"target\": \"17\", \"value\": 1403, \"time\": 1}, {\"source\": \"128\", \"target\": \"171\", \"value\": 1811, \"time\": 1}, {\"source\": \"128\", \"target\": \"1\", \"value\": 1182, \"time\": 1}, {\"source\": \"128\", \"target\": \"49\", \"value\": 1518, \"time\": 1}, {\"source\": \"129\", \"target\": \"31\", \"value\": 1631, \"time\": 1}, {\"source\": \"129\", \"target\": \"54\", \"value\": 1872, \"time\": 1}, {\"source\": \"129\", \"target\": \"47\", \"value\": 1320, \"time\": 1}, {\"source\": \"131\", \"target\": \"156\", \"value\": 1026, \"time\": 1}, {\"source\": \"131\", \"target\": \"127\", \"value\": 1108, \"time\": 1}, {\"source\": \"132\", \"target\": \"48\", \"value\": 1275, \"time\": 1}, {\"source\": \"132\", \"target\": \"126\", \"value\": 1613, \"time\": 1}, {\"source\": \"132\", \"target\": \"161\", \"value\": 1614, \"time\": 1}, {\"source\": \"132\", \"target\": \"32\", \"value\": 1785, \"time\": 1}, {\"source\": \"133\", \"target\": \"102\", \"value\": 1964, \"time\": 1}, {\"source\": \"134\", \"target\": \"89\", \"value\": 1256, \"time\": 1}, {\"source\": \"134\", \"target\": \"171\", \"value\": 1831, \"time\": 1}, {\"source\": \"134\", \"target\": \"100\", \"value\": 1311, \"time\": 1}, {\"source\": \"134\", \"target\": \"110\", \"value\": 1519, \"time\": 1}, {\"source\": \"135\", \"target\": \"183\", \"value\": 1990, \"time\": 1}, {\"source\": \"135\", \"target\": \"100\", \"value\": 1974, \"time\": 1}, {\"source\": \"136\", \"target\": \"181\", \"value\": 1580, \"time\": 1}, {\"source\": \"136\", \"target\": \"66\", \"value\": 1777, \"time\": 1}, {\"source\": \"137\", \"target\": \"104\", \"value\": 1963, \"time\": 1}, {\"source\": \"137\", \"target\": \"172\", \"value\": 1142, \"time\": 1}, {\"source\": \"138\", \"target\": \"88\", \"value\": 1423, \"time\": 1}, {\"source\": \"139\", \"target\": \"39\", \"value\": 1918, \"time\": 1}, {\"source\": \"140\", \"target\": \"25\", \"value\": 1918, \"time\": 1}, {\"source\": \"140\", \"target\": \"102\", \"value\": 1068, \"time\": 1}, {\"source\": \"141\", \"target\": \"36\", \"value\": 1706, \"time\": 1}, {\"source\": \"141\", \"target\": \"123\", \"value\": 1081, \"time\": 1}, {\"source\": \"141\", \"target\": \"77\", \"value\": 1188, \"time\": 1}, {\"source\": \"141\", \"target\": \"186\", \"value\": 1711, \"time\": 1}, {\"source\": \"142\", \"target\": \"76\", \"value\": 1865, \"time\": 1}, {\"source\": \"142\", \"target\": \"64\", \"value\": 1640, \"time\": 1}, {\"source\": \"142\", \"target\": \"9\", \"value\": 1237, \"time\": 1}, {\"source\": \"145\", \"target\": \"7\", \"value\": 1612, \"time\": 1}, {\"source\": \"145\", \"target\": \"185\", \"value\": 1436, \"time\": 1}, {\"source\": \"145\", \"target\": \"17\", \"value\": 1508, \"time\": 1}, {\"source\": \"146\", \"target\": \"50\", \"value\": 1439, \"time\": 1}, {\"source\": \"146\", \"target\": \"56\", \"value\": 1800, \"time\": 1}, {\"source\": \"146\", \"target\": \"26\", \"value\": 1372, \"time\": 1}, {\"source\": \"148\", \"target\": \"118\", \"value\": 1647, \"time\": 1}, {\"source\": \"148\", \"target\": \"131\", \"value\": 1437, \"time\": 1}, {\"source\": \"148\", \"target\": \"166\", \"value\": 1576, \"time\": 1}, {\"source\": \"148\", \"target\": \"76\", \"value\": 1754, \"time\": 1}, {\"source\": \"149\", \"target\": \"73\", \"value\": 1800, \"time\": 1}, {\"source\": \"149\", \"target\": \"124\", \"value\": 1586, \"time\": 1}, {\"source\": \"150\", \"target\": \"58\", \"value\": 1026, \"time\": 1}, {\"source\": \"151\", \"target\": \"89\", \"value\": 1202, \"time\": 1}, {\"source\": \"152\", \"target\": \"49\", \"value\": 1814, \"time\": 1}, {\"source\": \"152\", \"target\": \"147\", \"value\": 1584, \"time\": 1}, {\"source\": \"152\", \"target\": \"89\", \"value\": 1449, \"time\": 1}, {\"source\": \"153\", \"target\": \"177\", \"value\": 1807, \"time\": 1}, {\"source\": \"153\", \"target\": \"127\", \"value\": 1289, \"time\": 1}, {\"source\": \"155\", \"target\": \"101\", \"value\": 1231, \"time\": 1}, {\"source\": \"156\", \"target\": \"40\", \"value\": 1626, \"time\": 1}, {\"source\": \"157\", \"target\": \"60\", \"value\": 1848, \"time\": 1}, {\"source\": \"157\", \"target\": \"130\", \"value\": 1040, \"time\": 1}, {\"source\": \"158\", \"target\": \"132\", \"value\": 1095, \"time\": 1}, {\"source\": \"159\", \"target\": \"9\", \"value\": 1713, \"time\": 1}, {\"source\": \"159\", \"target\": \"178\", \"value\": 1954, \"time\": 1}, {\"source\": \"159\", \"target\": \"21\", \"value\": 1251, \"time\": 1}, {\"source\": \"159\", \"target\": \"165\", \"value\": 1319, \"time\": 1}, {\"source\": \"161\", \"target\": \"167\", \"value\": 1026, \"time\": 1}, {\"source\": \"162\", \"target\": \"69\", \"value\": 1086, \"time\": 1}, {\"source\": \"162\", \"target\": \"119\", \"value\": 1902, \"time\": 1}, {\"source\": \"163\", \"target\": \"186\", \"value\": 1748, \"time\": 1}, {\"source\": \"163\", \"target\": \"127\", \"value\": 1144, \"time\": 1}, {\"source\": \"163\", \"target\": \"96\", \"value\": 1726, \"time\": 1}, {\"source\": \"164\", \"target\": \"113\", \"value\": 1644, \"time\": 1}, {\"source\": \"164\", \"target\": \"158\", \"value\": 1395, \"time\": 1}, {\"source\": \"165\", \"target\": \"64\", \"value\": 1803, \"time\": 1}, {\"source\": \"166\", \"target\": \"38\", \"value\": 1079, \"time\": 1}, {\"source\": \"166\", \"target\": \"195\", \"value\": 1189, \"time\": 1}, {\"source\": \"166\", \"target\": \"42\", \"value\": 1601, \"time\": 1}, {\"source\": \"167\", \"target\": \"39\", \"value\": 1933, \"time\": 1}, {\"source\": \"168\", \"target\": \"29\", \"value\": 1339, \"time\": 1}, {\"source\": \"168\", \"target\": \"15\", \"value\": 1387, \"time\": 1}, {\"source\": \"169\", \"target\": \"81\", \"value\": 1387, \"time\": 1}, {\"source\": \"170\", \"target\": \"188\", \"value\": 1622, \"time\": 1}, {\"source\": \"170\", \"target\": \"109\", \"value\": 1331, \"time\": 1}, {\"source\": \"172\", \"target\": \"101\", \"value\": 1891, \"time\": 1}, {\"source\": \"172\", \"target\": \"98\", \"value\": 1866, \"time\": 1}, {\"source\": \"172\", \"target\": \"143\", \"value\": 1891, \"time\": 1}, {\"source\": \"173\", \"target\": \"190\", \"value\": 1497, \"time\": 1}, {\"source\": \"173\", \"target\": \"162\", \"value\": 1739, \"time\": 1}, {\"source\": \"174\", \"target\": \"143\", \"value\": 1903, \"time\": 1}, {\"source\": \"175\", \"target\": \"97\", \"value\": 1575, \"time\": 1}, {\"source\": \"175\", \"target\": \"6\", \"value\": 1408, \"time\": 1}, {\"source\": \"176\", \"target\": \"178\", \"value\": 1611, \"time\": 1}, {\"source\": \"176\", \"target\": \"29\", \"value\": 1764, \"time\": 1}, {\"source\": \"177\", \"target\": \"126\", \"value\": 1396, \"time\": 1}, {\"source\": \"178\", \"target\": \"106\", \"value\": 1412, \"time\": 1}, {\"source\": \"178\", \"target\": \"46\", \"value\": 1726, \"time\": 1}, {\"source\": \"179\", \"target\": \"72\", \"value\": 1845, \"time\": 1}, {\"source\": \"180\", \"target\": \"144\", \"value\": 1121, \"time\": 1}, {\"source\": \"181\", \"target\": \"160\", \"value\": 1327, \"time\": 1}, {\"source\": \"181\", \"target\": \"179\", \"value\": 1411, \"time\": 1}, {\"source\": \"182\", \"target\": \"95\", \"value\": 1490, \"time\": 1}, {\"source\": \"183\", \"target\": \"68\", \"value\": 1852, \"time\": 1}, {\"source\": \"183\", \"target\": \"44\", \"value\": 1051, \"time\": 1}, {\"source\": \"185\", \"target\": \"99\", \"value\": 1442, \"time\": 1}, {\"source\": \"186\", \"target\": \"122\", \"value\": 1300, \"time\": 1}, {\"source\": \"187\", \"target\": \"96\", \"value\": 1558, \"time\": 1}, {\"source\": \"187\", \"target\": \"124\", \"value\": 1419, \"time\": 1}, {\"source\": \"188\", \"target\": \"49\", \"value\": 1781, \"time\": 1}, {\"source\": \"189\", \"target\": \"180\", \"value\": 1370, \"time\": 1}, {\"source\": \"189\", \"target\": \"152\", \"value\": 1618, \"time\": 1}, {\"source\": \"189\", \"target\": \"54\", \"value\": 1688, \"time\": 1}, {\"source\": \"190\", \"target\": \"178\", \"value\": 1298, \"time\": 1}, {\"source\": \"191\", \"target\": \"167\", \"value\": 1286, \"time\": 1}, {\"source\": \"191\", \"target\": \"40\", \"value\": 1460, \"time\": 1}, {\"source\": \"192\", \"target\": \"70\", \"value\": 1652, \"time\": 1}, {\"source\": \"193\", \"target\": \"168\", \"value\": 1472, \"time\": 1}, {\"source\": \"194\", \"target\": \"117\", \"value\": 1381, \"time\": 1}, {\"source\": \"194\", \"target\": \"101\", \"value\": 1062, \"time\": 1}, {\"source\": \"195\", \"target\": \"146\", \"value\": 1385, \"time\": 1}, {\"source\": \"196\", \"target\": \"45\", \"value\": 1428, \"time\": 1}, {\"source\": \"196\", \"target\": \"146\", \"value\": 1528, \"time\": 1}, {\"source\": \"196\", \"target\": \"74\", \"value\": 1347, \"time\": 1}, {\"source\": \"196\", \"target\": \"160\", \"value\": 1998, \"time\": 1}, {\"source\": \"197\", \"target\": \"36\", \"value\": 1172, \"time\": 1}, {\"source\": \"198\", \"target\": \"90\", \"value\": 1736, \"time\": 1}, {\"source\": \"198\", \"target\": \"51\", \"value\": 1114, \"time\": 1}, {\"source\": \"198\", \"target\": \"188\", \"value\": 1880, \"time\": 1}, {\"source\": \"198\", \"target\": \"120\", \"value\": 1998, \"time\": 1}, {\"source\": \"199\", \"target\": \"77\", \"value\": 1390, \"time\": 1}]}";
    // defaultData = Constant.data
    dataJsonString: string = this.defaultData;

    constructor() {
        const N = 3
        /** constructing the nodes array */
        // for (let i = 1; i <= N; i++) {
        //     this.nodes.push(new NodeGraph(String(i), this.nodes.length));
        // }
        // // this.nodes.push(new NodeGraph("1"));
        // // this.nodes.push(new NodeGraph("2"));
        // console.log("soak node ",   this.nodes);
        // this.links.push(new Link(this.nodes[0], this.nodes[1], 0, 0));
        // this.nodes[0].linkCount++;
        // this.nodes[1].linkCount++;
        this.parsing(this.defaultData);

    }

    ngOnInit() {
    }

    ngOnDestroy() {

    }

    parsing(data: string) {
        let objJson = JSON.parse(data);
        for(const event in objJson){
            const dataCopy = objJson[event];
            for (let key in dataCopy){
                if (event == "nodes") {
                    this.mapNodes.set(dataCopy[key].id, new NodeGraph(dataCopy[key].id, this.nodes.length))
                } else if (event == "links") {
                    let source = this.mapNodes.get(dataCopy[key].source);
                    let target = this.mapNodes.get(dataCopy[key].target);
                    if (source && target) {
                        this.allLinks.push(new Link(source, target, dataCopy[key].value, dataCopy[key].time))
                        if (Number(dataCopy[key].time) === Number(this.time)) {
                            this.links.push(new Link(source, target, dataCopy[key].value, dataCopy[key].time));
                            source.linkCount++;
                            target.linkCount++;
                        }
                    }
                }
            }
        }
        this.mapNodes.forEach((key, value) => {
            this.nodes.push(key);
        });
    }

    getLinkWithTime() {
        this.links = [];
        this.allLinks.forEach((key) => {
            let source = key.source;
            let target = key.target;
            if (Number(key.time) === Number(this.time)) {
                this.links.push(key);
                source.linkCount++;
                target.linkCount++;
            }
        });
    }

    changeMain(state: number) {
        if (state !== this.state) {
            this.state = state;
        }
    }

    onSubmitData() {
        this.nodes = [];
        this.links = [];
        if (this.slider) {
            this.time = this.slider.nativeElement.value;
        }
        this.mapNodes = new Map<string, NodeGraph>();
        this.allLinks = [];
        this.dataJsonString = document.forms[0]['textarea'].value;
        this.parsing(this.dataJsonString);
    }

    onSubmitTime() {
        this.mapNodes = new Map<string, NodeGraph>();
        if (this.slider) {
            this.time = this.slider.nativeElement.value;
        }
        this.getLinkWithTime()
    }
}
